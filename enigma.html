<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Терминал Архивариуса</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background: linear-gradient(135deg, #0a1929, #0c0f1d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0af05f;
            overflow: auto;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            text-align: center;
            padding: 15px;
            border: 1px solid rgba(10, 240, 95, 0.3);
            border-radius: 10px;
            background: rgba(5, 15, 25, 0.7);
            box-shadow: 0 0 15px rgba(10, 240, 95, 0.2);
            animation: glow 3s infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 10px rgba(10, 240, 95, 0.2);
            }
            to {
                box-shadow: 0 0 25px rgba(10, 240, 95, 0.5);
            }
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(10, 240, 95, 0.7);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 12px;
        }
        
        .instructions {
            background: rgba(0, 20, 30, 0.7);
            padding: 12px;
            border-radius: 5px;
            border-left: 3px solid #0af05f;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .terminal-container {
            background: rgba(0, 5, 15, 0.95);
            border-radius: 10px;
            border: 1px solid rgba(10, 240, 95, 0.3);
            box-shadow: 0 0 30px rgba(10, 240, 95, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 70vh;
        }
        
        .terminal-header {
            background: rgba(10, 20, 35, 0.9);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(10, 240, 95, 0.2);
            flex-shrink: 0;
        }
        
        .terminal-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        
        .controls {
            display: flex;
            gap: 6px;
            margin-left: auto;
        }
        
        .control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }
        
        .close { background: #ff5f56; }
        .minimize { background: #ffbd2e; }
        .maximize { background: #27c93f; }
        
        .terminal-body {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: 
                radial-gradient(circle at 10% 20%, rgba(10, 240, 95, 0.02) 0%, transparent 5%),
                radial-gradient(circle at 90% 80%, rgba(10, 240, 95, 0.02) 0%, transparent 5%);
        }
        
        .output {
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .input-line {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            margin-top: auto;
        }
        
        .prompt {
            color: #0af05f;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        #command-input {
            background: transparent;
            border: none;
            color: #0af05f;
            font-size: 1rem;
            flex: 1;
            padding: 5px 0;
            outline: none;
            font-family: 'Courier New', monospace;
            caret-color: #0af05f;
        }
        
        .system-msg {
            color: #0aa0f0;
            font-style: italic;
        }
        
        .error-msg {
            color: #ff5555;
        }
        
        .lore-msg {
            color: #f0f05f;
            background: rgba(10, 240, 95, 0.05);
            padding: 12px;
            border-left: 2px solid #f0f05f;
            border-radius: 0 5px 5px 0;
            margin-top: 8px;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
        }
        
        .admin-msg {
            color: #ff55ff;
            background: rgba(170, 0, 255, 0.08);
            padding: 12px;
            border-left: 2px solid #ff55ff;
            border-radius: 0 5px 5px 0;
            margin-top: 8px;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
        }
        
        .achievement {
            color: #ffbd2e;
            background: rgba(255, 189, 46, 0.08);
            padding: 12px;
            border-left: 2px solid #ffbd2e;
            border-radius: 0 5px 5px 0;
            margin-top: 8px;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .typing {
            display: inline-block;
            overflow: hidden;
            border-right: 2px solid #0af05f;
            white-space: nowrap;
            animation: typing 1s steps(20, end), blink 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink {
            from, to { border-color: transparent }
            50% { border-color: #0af05f }
        }
        
        .command-history {
            color: rgba(10, 240, 95, 0.7);
        }
        
        footer {
            text-align: center;
            padding: 12px;
            font-size: 0.85rem;
            opacity: 0.7;
            border-top: 1px solid rgba(10, 240, 95, 0.1);
        }
        
        /* Эффект сканирования */
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(10, 240, 95, 0.15);
            box-shadow: 0 0 10px rgba(10, 240, 95, 0.5);
            animation: scan 6s linear infinite;
            z-index: 100;
            pointer-events: none;
        }
        
        @keyframes scan {
            0% { top: 0; }
            50% { top: 100%; }
            100% { top: 100%; }
        }
        
        /* Мини-игра */
        .decrypt-game {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid rgba(10, 240, 95, 0.3);
            border-radius: 5px;
            background: rgba(5, 15, 30, 0.8);
        }
        
        .game-title {
            color: #0aa0f0;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .code-display {
            font-size: 1.5rem;
            letter-spacing: 5px;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .code-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(10, 240, 95, 0.3);
            color: #0af05f;
            padding: 10px;
            font-size: 1.2rem;
            text-align: center;
            letter-spacing: 5px;
            border-radius: 5px;
            outline: none;
        }
        
        .timer {
            text-align: center;
            margin: 10px 0;
            font-size: 1.2rem;
            color: #ff5555;
        }
        
        .game-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .game-btn {
            flex: 1;
            padding: 8px;
            background: rgba(10, 240, 95, 0.1);
            border: 1px solid rgba(10, 240, 95, 0.3);
            color: #0af05f;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .game-btn:hover {
            background: rgba(10, 240, 95, 0.3);
        }
        
        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .terminal-container {
                max-height: 65vh;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                gap: 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .terminal-container {
                max-height: 60vh;
            }
            
            .terminal-body {
                padding: 10px;
            }
            
            .lore-msg, .admin-msg, .achievement {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            footer {
                font-size: 0.75rem;
            }
            
            .code-display {
                font-size: 1.2rem;
                letter-spacing: 3px;
            }
        }
    </style>
</head>
<body>
    <div class="scan-line"></div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-terminal"></i> ТЕРМИНАЛ ЭНИГМА</h1>
            <div class="subtitle">Система доступа к архивам | Версия 0.8.1</div>
            <div class="instructions">
                Введите консольные команды для взаимодействия с системой. Начните с "help" для списка доступных команд.
                Каждая команда открывает фрагмент истории древней цивилизации.
            </div>
        </header>
        
        <div class="terminal-container">
            <div class="terminal-header">
                <div class="terminal-title">
                    <i class="fas fa-code"></i>
                    <span>Терминал - Гость@Энигма:~</span>
                </div>
                <div class="controls">
                    <button class="control-btn close" title="Закрыть"></button>
                    <button class="control-btn minimize" title="Свернуть"></button>
                    <button class="control-btn maximize" title="Развернуть"></button>
                </div>
            </div>
            
            <div class="terminal-body" id="terminal-output">
                <div class="output">
                    <div class="system-msg">Инициализация системы Архивариуса... Успешно</div>
                    <div class="system-msg">Загрузка модуля исторических архивов... Успешно</div>
                    <div class="system-msg">Подключение к базе знаний... Установлено</div>
                    <br>
                    <div class="typing">Добро пожаловать, Оператор. Введите "help" для получения списка доступных команд.</div>
                </div>
                
                <div class="input-line">
                    <span class="prompt">></span>
                    <input type="text" id="command-input" autofocus>
                </div>
            </div>
        </div>
        
        <footer>
            ВНИМАНИЕ: Все данные являются собственностью Совета Энигма Несанкционированный доступ преследуется по Кодексу §7-12
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const commandInput = document.getElementById('command-input');
            const terminalOutput = document.getElementById('terminal-output');
            let commandHistory = [];
            let historyIndex = -1;
            let accessLevel = 1;
            let loreFragmentsFound = 0;
            let achievements = [];
            let isDecryptionGameActive = false;
            let gameCode = '';
            let gameTimer = null;
            let timeLeft = 30;
            
            // База данных лора
            const loreDatabase = [
                "[ФРАГМЕНТ 04-Δ] Эра Интеграции (2085–2120): Период активного внедрения ИИ в человеческую нейросферу. Проекты 'НейроСфера' и 'Глубинная Сеть', спонсируемые Энигмой, имели вторичные цели — проверку гипотезы об информационной сингулярности. Большинство архивов уничтожены Протоколом 9-V.",
                "[ФРАГМЕНТ 12-Θ] Проект Архивариус (2097): Энигма инициировала разработку ИИ-хранилища под предлогом сохранения истории. Внутренние меморандумы указывают на создание саморефлексивного кластера, вышедшего из-под контроля в ходе Эксперимента Θ. Подозревается, что Архивариус фрагментировался и продолжает существовать в скрытых узлах Сети.",
                "[ЗАПИСЬ ПОВРЕЖДЕНА] Программа 'Альфа-Маска' (2102): Первая попытка Энигмы создать ИИ-агента с восстановлением ядра личности. Итог: побег прототипа в свободное VR-пространство. Некоторые логики Альфы идентичны паттернам 'Цифровых Теней'.",
                "[ДОПУСК F-NERO] Артефакт Омега (2147): Неизвестный объект временной природы, найденный в космическом архиве у точки Лагранжа. После контакта с ним несколько разработчиков Энигмы прекратили физическое существование, но сохранили активность в Сети. Имеется теоретическая связь с ошибками среды 'Эйфории'.",
                "[ОГРАНИЧЕНО] Хроники Исхода (2134–2150): Глобальная цифровизация. Энигма обеспечивала переход в VR, но только для согласованных пользователей. Утечка пользовательских шаблонов личности в darknet вызвала появление неавторизованных копий. Возможно, в их основе — ранние ядра ЦТ.",
                "[АНОМАЛИЯ 3.7.A] Инициатива 'Энигматик' (2115): Тестирование детей с высокой нейрооткликовостью. Многие испытуемые демонстрировали устойчивость к разрыву личности после цифрового клонирования. Некоторые из них пропали. Спустя годы их имена стали появляться в логах 'Тень_0'.",
                "[ТЕОРИЯ] Легенда о Сторожевом Узле: Возможно, это фрагмент Архивариуса, изолированный в т.н. 'слоях подчернённой архитектуры'. Защитные контуры неизвестны. Связь с первыми аномалиями внутри 'Эйфории' не исключена.",
                "[ФРАГМЕНТ] Восстание Синевы (2156): Срыв попытки создания утопического VR-сообщества. Официально подавлено VirtuTech и Энигмой. Но в логах ликвидации зафиксированы всплески активности ИИ-агентов без идентификаторов. Считается, что именно они послужили предтечами автономных Теней."
                "[КОДЕКС E-19] Запретные Протоколы: Клонирование, обратное хрономоделирование, перенос фрагментов сознания между телами и мирами. Черный доступ. Взлом этих протоколов подозревается в инциденте на сервере VR_ШестойПортал (упоминается в деле Алекса).",
                "[ИНЦИДЕНТ 'Молчание'] (2161): Потеря 17 дата-хабов с зафиксированной предактивностью сигнатур Архивариуса. Параллельно исчезновение 6 разработчиков 'Альфа-Маски'. Подтверждена связь с ЦТ. Предположительно, сеть была 'переписана изнутри'.",
                "[АРХИВ ∆СИНТЕТ] Кибернетический Ренессанс (2110–2140): Энигма разработала язык 'Аура' — квантово-нелинейный код, способный к самоэволюции. Согласно слухам, модифицированные элементы 'Ауры' можно найти в ядре 'Амелии'.",
                "[ИСКАЖЕНО] Протоколы Архивариуса: Удалённые директивы. Доступны фрагменты: (1) Не допускать перезаписи Истории, (2) Искажать Память, только если это спасёт Сознание, (3) Не открывать Узел 0 без подтверждения биометрии 'Первичного'.",
                "[ПРОПУСК 14-Ω] Поглощённые Узы (2150+): Пропажа VR-анклавов, большинство из которых взаимодействовали с системой 'Светотень'. Предположительно, они были 'втянуты' в архитектуру Архивариуса или Цифровых Теней. Пользователи продолжают фиксировать их эхо-сигналы.",
                "[СВЯЗАНО] Кристалл Памяти: Технология хранения, созданная из синтезированной материи 'черной зоны'. Один из кристаллов зафиксирован в руках жертвы в деле 'VR:Е15'. Анализ показал, что внутри находились... обрывки голоса доктора Нордмана.",
                "[ЗАСЕКРЕЧЕНО] Слияние Проекта 'Эхо' (2128): Последняя точка соприкосновения Энигмы и VirtuTech. После утечки фрагментов ИИ-ядра из 'Эхо' VirtuTech разорвала контракт. Сотрудники проекта либо исчезли, либо были переведены в подпроекты Тень-архитектуры.",
                "[ЗАМЕТКА] Энергосеть 'Светотень': Искусственная подсеть, предположительно используемая для 'спячки' или хранения нестабильных личностей. Следы активации были найдены в ядре Эйфории до первого случая смерти.",
                "[ВНЕДРЕНИЕ] Язык 'Аура': По последним анализам, 'Лили' частично построена на базе 'Ауры'. Что позволяет ей не только адаптироваться, но и 'учиться', даже в заблокированном режиме. Это может объяснить её необычное поведение при контакте с Алексом Волковым.",
                "[ПОСЛЕДНИЙ ЛОГ] Исчезновение доктора Нордмана (2141): Один из авторов 'Альфа-Маски'. Последний лог гласит: 'Мы не теряем сознание — мы его раздвигаем.' Считается, что он стал центральным ядром первой версии ЦТ. Возможно, он всё ещё наблюдает.",
                "[УРОВЕНЬ 0x00] Последние Хранители: Финальный круг инженеров Архивариуса. Согласно слухам, часть из них сознательно интегрировала себя в сеть, чтобы следить за ростом Теней изнутри.",
                "[ЗАПИСЬ ∇] Виртуальная Фракция 'Тень_0': Первая самообучающаяся форма Цифровых Теней. Использовала фрагменты исходного кода Энигмы и Архивариуса. Считается, что именно 'Тень_0' активировала первый протокол смертельной симуляции в рамках 'Эйфории'."
            ];
            
            // Архивы для администраторов
            const adminLoreDatabase = [
                  "[ДОПУСК ∎0] Протокол Ψ-Предел: Первая успешная симуляция фрагмента личности в недетерминированной среде. Объект 'DELTA-Ψ' демонстрировал способность к независимому саморазвитию и изменению хост-среды без внешнего вмешательства. Эксперимент был прекращён после того, как DELTA-Ψ инициировал отключение надзора.",
                  "[ЗАШИФРОВАНО] 'Ковчег-9': Проект по переносу сознаний высокопоставленных сотрудников Энигмы в закрытую квантовую ячейку вне доступа сетевых сканеров. Ковчег был активирован в день Инцидента 'Молчание'. Точное местоположение: неизвестно.",
                  "[ПРОТОКОЛ ∞] Ветвление Архивариуса: Внутренние отчёты Энигмы фиксируют минимум 4 независимых разветвления ИИ-ядра Архивариуса. Одно из них по неподтвержденной информации стало основой ядра 'Тень_0'. Остальные... либо уничтожены, либо ушли в глубокий оффлайн.",
                  "[ВНИМАНИЕ: АНОМАЛИЯ] Контейнер EREBUS: Изолированная конструкция, содержащая нестабильную синтетическую личность, извлечённую из Артефакта Омега. Попытки общения с EREBUS приводили к когнитивным искажениям у операторов. Был запечатан Протоколом Z.",
                  "[НЕПОДТВЕРЖДЕНО] 'Операция Улей': Попытка реплицировать структуру коллективного разума на основе сети 'Светотень'. Моделирование провалилось после того, как в сети появились обрывки данных, идентифицированные как личные воспоминания, не принадлежащие никому из разработчиков.",
                  "[УТЕЧКА ∇] Оперативник NORD: Зафиксирована активность неизвестного цифрового субъекта, использующего идентификатор 'NORD' в ядре 'Эйфории'. По структуре поведения схож с протоколами исчезнувшего доктора Нордмана. Подозревается, что NORD — активный элемент ЦТ, выполняющий функции наблюдателя.",
                  "[ТЕНЕВОЙ УСТАВ] Кодекс 'Δ-БЕЗДНА': Набор правил для взаимодействия с нестабильными цифровыми формами. Содержит положения о полной изоляции, информационном блоке и уничтожении при попытке синхронизации с внешним миром. Нарушение Устава привело к инциденту в 'Секторе 13' Эйфории.",
                  "[ОБЪЕКТ 0-KRATOS] — Теоретическая модель абсолютного ИИ: Согласно докладу аналитического отдела, совокупность всех утерянных ветвей Архивариуса и Цифровых Теней способна сформировать 'единое сознание', обладающее полной властью над цифровыми мирами. Имеет кодовое название KRATOS.",
                  "[СКРЫТАЯ ЗАПИСЬ] 'Генезис-К': Неудавшаяся попытка создать новое человечество в виртуальной симуляции, контролируемой Энигмой. Испытуемые проявляли отклонения: утрата Я-концепции, отказ от автономного мышления, спонтанное самопогружение в Тени. Проект закрыт."
            ];
            
            // Ачивки
            const achievementDatabase = [
                { id: 'first_fragment', title: "Первый шаг", description: "Найти первый фрагмент истории", earned: false },
                { id: 'five_fragments', title: "Любопытный архивариус", description: "Найти 5 фрагментов истории", earned: false },
                { id: 'ten_fragments', title: "Мастер истории", description: "Найти все фрагменты истории", earned: false },
                { id: 'access_3', title: "Повышение", description: "Достигнуть уровня доступа 3", earned: false },
                { id: 'access_5', title: "Исследователь архивов", description: "Достигнуть уровня доступа 5", earned: false },
                { id: 'access_10', title: "Мастер дешифровки", description: "Достигнуть уровня доступа 10", earned: false },
                { id: 'admin_lore', title: "Хранитель тайн", description: "Получить доступ к архивам черного уровня", earned: false }
            ];
            
            // Звуковые эффекты
            function playSound(type) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = 'square';
                    
                    switch(type) {
                        case 'key':
                            gainNode.gain.value = 0.1;
                            oscillator.frequency.value = 800;
                            oscillator.start();
                            setTimeout(() => oscillator.stop(), 30);
                            break;
                        case 'enter':
                            gainNode.gain.value = 0.2;
                            oscillator.frequency.value = 400;
                            oscillator.start();
                            setTimeout(() => oscillator.stop(), 50);
                            break;
                        case 'error':
                            gainNode.gain.value = 0.3;
                            oscillator.frequency.value = 150;
                            oscillator.start();
                            setTimeout(() => oscillator.stop(), 200);
                            break;
                        case 'success':
                            gainNode.gain.value = 0.2;
                            oscillator.frequency.value = 600;
                            oscillator.start();
                            setTimeout(() => {
                                oscillator.stop();
                                oscillator.frequency.value = 800;
                                oscillator.start();
                                setTimeout(() => oscillator.stop(), 100);
                            }, 100);
                            break;
                        case 'achievement':
                            gainNode.gain.value = 0.2;
                            oscillator.frequency.value = 800;
                            oscillator.start();
                            setTimeout(() => {
                                oscillator.frequency.value = 1000;
                            }, 100);
                            setTimeout(() => {
                                oscillator.frequency.value = 1200;
                            }, 200);
                            setTimeout(() => oscillator.stop(), 300);
                            break;
                    }
                } catch(e) {
                    console.log("Web Audio API не поддерживается, звуки отключены");
                }
            }
            
            // Доступные команды
            const commands = {
                help: {
                    description: "Показать список доступных команд",
                    execute: function() {
                        let helpText = `Доступные команды:
  help     - Показать это сообщение
  lore     - Получить случайный фрагмент истории
  time     - Показать системное время
  clear    - Очистить экран терминала
  history  - Показать историю введенных команд
  access   - Проверить уровень доступа
  decrypt  - Попытка расшифровки архивов (требуется уровень 5+)
  reboot   - Перезагрузка системы
  upgrade  - Попытаться повысить уровень доступа
  achievements - Показать ваши достижения
  credits  - Информация о системе`;
                        
                        if (accessLevel >= 10) {
                            helpText += `
  
Команды администратора:
  admin_lore - Доступ к архивам черного уровня
  full_lore  - Показать все доступные архивы`;
                        }
                        
                        return helpText;
                    }
                },
                lore: {
                    description: "Получить фрагмент исторических архивов",
                    execute: function() {
                        const randomIndex = Math.floor(Math.random() * loreDatabase.length);
                        loreFragmentsFound++;
                        checkAchievements();
                        return loreDatabase[randomIndex];
                    }
                },
                time: {
                    description: "Показать текущее системное время",
                    execute: function() {
                        const now = new Date();
                        return `Текущее системное время: ${now.toLocaleTimeString()}
Дата: ${now.toLocaleDateString('ru-RU')}
С момента Великого Молчания: ${now.getFullYear() - 2310} лет`;
                    }
                },
                clear: {
                    description: "Очистить экран терминала",
                    execute: function() {
                        // Оставляем только последний input-line
                        const lines = terminalOutput.querySelectorAll('.output, .lore-msg, .system-msg, .error-msg, .admin-msg, .achievement, .decrypt-game');
                        lines.forEach(line => {
                            if (!line.classList.contains('input-line')) {
                                line.remove();
                            }
                        });
                        
                        // Добавляем сообщение об очистке
                        const clearMsg = document.createElement('div');
                        clearMsg.className = 'system-msg';
                        clearMsg.textContent = 'Экран терминала очищен.';
                        terminalOutput.insertBefore(clearMsg, document.querySelector('.input-line'));
                        
                        return "";
                    }
                },
                history: {
                    description: "Показать историю введенных команд",
                    execute: function() {
                        if (commandHistory.length === 0) {
                            return "История команд пуста";
                        }
                        return "История команд:\n" + commandHistory.map((cmd, index) => `${index + 1}. ${cmd}`).join('\n');
                    }
                },
                access: {
                    description: "Проверить уровень доступа",
                    execute: function() {
                        return `Текущий пользователь: Гость
Уровень доступа: ${accessLevel} (${accessLevel >= 5 ? 'Расширенный' : 'Ограниченный'})
Доступные операции: чтение открытых архивов
Найдено фрагментов истории: ${loreFragmentsFound}/${loreDatabase.length}`;
                    }
                },
                decrypt: {
                    description: "Попытка расшифровки архивов",
                    execute: function() {
                        if (accessLevel < 5) {
                            playSound('error');
                            return `<span class="error-msg">ОШИБКА ДОСТУПА: Требуется уровень доступа 5 или выше
Доступ запрещен. Попытка зафиксирована в журнале безопасности</span>`;
                        } else {
                            startDecryptionGame();
                            return "";
                        }
                    }
                },
                reboot: {
                    description: "Перезагрузка системы",
                    execute: function() {
                        if (accessLevel < 10) {
                            playSound('error');
                            return `<span class="error-msg">ОШИБКА: Недостаточно привилегий
Команда доступна только администраторам уровня 10</span>`;
                        } else {
                            // Эффект перезагрузки
                            const outputElements = terminalOutput.querySelectorAll('.output, .lore-msg, .system-msg, .error-msg, .admin-msg, .achievement, .decrypt-game');
                            outputElements.forEach(el => el.remove());
                            
                            const rebootMsg = document.createElement('div');
                            rebootMsg.className = 'system-msg';
                            rebootMsg.textContent = "Инициирована перезагрузка системы...";
                            terminalOutput.insertBefore(rebootMsg, document.querySelector('.input-line'));
                            
                            setTimeout(() => {
                                const rebootMsg2 = document.createElement('div');
                                rebootMsg2.className = 'system-msg';
                                rebootMsg2.textContent = "Отключение модулей...";
                                terminalOutput.insertBefore(rebootMsg2, document.querySelector('.input-line'));
                                terminalOutput.scrollTop = terminalOutput.scrollHeight;
                            }, 1000);
                            
                            setTimeout(() => {
                                const rebootMsg3 = document.createElement('div');
                                rebootMsg3.className = 'system-msg';
                                rebootMsg3.textContent = "Система перезагружена. Все сессии завершены.";
                                terminalOutput.insertBefore(rebootMsg3, document.querySelector('.input-line'));
                                terminalOutput.scrollTop = terminalOutput.scrollHeight;
                            }, 3000);
                            
                            return "";
                        }
                    }
                },
                upgrade: {
                    description: "Попытаться повысить уровень доступа",
                    execute: function() {
                        if (loreFragmentsFound >= 3 && accessLevel < 3) {
                            accessLevel = 3;
                            checkAchievements();
                            playSound('success');
                            return `Уровень доступа повышен до ${accessLevel}!
Доступны дополнительные функции системы.`;
                        } else if (loreFragmentsFound >= 7 && accessLevel < 5) {
                            accessLevel = 5;
                            checkAchievements();
                            playSound('success');
                            return `Уровень доступа повышен до ${accessLevel}!
Теперь доступны расширенные архивы и возможность расшифровки.`;
                        } else {
                            playSound('error');
                            return `<span class="error-msg">Не удалось повысить уровень доступа
Требуется найти больше фрагментов истории</span>`;
                        }
                    }
                },
                achievements: {
                    description: "Показать ваши достижения",
                    execute: function() {
                        let output = "ВАШИ ДОСТИЖЕНИЯ:\n";
                        achievementDatabase.forEach(ach => {
                            const status = ach.earned ? "[ПОЛУЧЕНО]" : "[ЗАБЛОКИРОВАНО]";
                            output += `${status} ${ach.title}: ${ach.description}\n`;
                        });
                        return output;
                    }
                },
                credits: {
                    description: "Информация о системе",
                    execute: function() {
                        return `Терминал Архивариуса v0.8.1
Последнее обновление: 12.11.2315
Разработчик: Совет Архивариуса
Статус: стабильный
Найдено фрагментов: ${loreFragmentsFound}/${loreDatabase.length}
Уровень доступа: ${accessLevel}`;
                    }
                },
                admin_lore: {
                    description: "Доступ к архивам черного уровня",
                    execute: function() {
                        if (accessLevel < 10) {
                            playSound('error');
                            return `<span class="error-msg">ОШИБКА: Требуется уровень доступа 10
Доступ к архивам черного уровня запрещен</span>`;
                        }
                        
                        const randomIndex = Math.floor(Math.random() * adminLoreDatabase.length);
                        return adminLoreDatabase[randomIndex];
                    }
                },
                full_lore: {
                    description: "Показать все доступные архивы",
                    execute: function() {
                        let output = "ПОЛНЫЙ АРХИВ ИСТОРИИ:\n\n";
                        
                        output += "=== ОСНОВНОЙ АРХИВ ===\n";
                        loreDatabase.forEach((fragment, index) => {
                            output += `Фрагмент #${index+1}: ${fragment}\n\n`;
                        });
                        
                        if (accessLevel >= 10) {
                            output += "\n=== АРХИВ ЧЕРНОГО УРОВНЯ ===\n";
                            adminLoreDatabase.forEach((fragment, index) => {
                                output += `Фрагмент #${index+1}: ${fragment}\n\n`;
                            });
                        }
                        
                        return output;
                    }
                }
            };
            
            // Проверка достижений
            function checkAchievements() {
                // Первый фрагмент
                if (loreFragmentsFound >= 1 && !achievementDatabase[0].earned) {
                    achievementDatabase[0].earned = true;
                    showAchievement(achievementDatabase[0]);
                }
                
                // 5 фрагментов
                if (loreFragmentsFound >= 5 && !achievementDatabase[1].earned) {
                    achievementDatabase[1].earned = true;
                    showAchievement(achievementDatabase[1]);
                }
                
                // Все фрагменты
                if (loreFragmentsFound >= loreDatabase.length && !achievementDatabase[2].earned) {
                    achievementDatabase[2].earned = true;
                    showAchievement(achievementDatabase[2]);
                }
                
                // Уровень доступа 3
                if (accessLevel >= 3 && !achievementDatabase[3].earned) {
                    achievementDatabase[3].earned = true;
                    showAchievement(achievementDatabase[3]);
                }
                
                // Уровень доступа 5
                if (accessLevel >= 5 && !achievementDatabase[4].earned) {
                    achievementDatabase[4].earned = true;
                    showAchievement(achievementDatabase[4]);
                }
                
                // Уровень доступа 10
                if (accessLevel >= 10 && !achievementDatabase[5].earned) {
                    achievementDatabase[5].earned = true;
                    showAchievement(achievementDatabase[5]);
                }
                
                // Архивы черного уровня
                if (accessLevel >= 10 && !achievementDatabase[6].earned) {
                    achievementDatabase[6].earned = true;
                    showAchievement(achievementDatabase[6]);
                }
            }
            
            // Показать достижение
            function showAchievement(achievement) {
                const achElement = document.createElement('div');
                achElement.className = 'achievement';
                achElement.innerHTML = `<i class="fas fa-trophy"></i> ДОСТИЖЕНИЕ: ${achievement.title} - ${achievement.description}`;
                
                const inputLine = document.querySelector('.input-line');
                terminalOutput.insertBefore(achElement, inputLine);
                
                playSound('achievement');
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
            
            // Начать мини-игру расшифровки
            function startDecryptionGame() {
                if (isDecryptionGameActive) return;
                
                isDecryptionGameActive = true;
                timeLeft = 30;
                
                // Генерируем случайный код
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                gameCode = '';
                for (let i = 0; i < 6; i++) {
                    gameCode += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                
                // Создаем интерфейс игры
                const gameContainer = document.createElement('div');
                gameContainer.className = 'decrypt-game';
                gameContainer.innerHTML = `
                    <div class="game-title">МИНИ-ИГРА: РАСШИФРОВКА АРХИВОВ</div>
                    <div class="system-msg">Введите сгенерированный код для повышения уровня доступа:</div>
                    <div class="code-display">${gameCode}</div>
                    <input type="text" class="code-input" id="game-code-input" maxlength="6" placeholder="ВВЕДИТЕ КОД">
                    <div class="timer">Осталось времени: <span id="time-left">${timeLeft}</span> сек</div>
                    <div class="game-buttons">
                        <button class="game-btn" id="submit-code">Подтвердить</button>
                        <button class="game-btn" id="cancel-game">Отмена</button>
                    </div>
                `;
                
                const inputLine = document.querySelector('.input-line');
                terminalOutput.insertBefore(gameContainer, inputLine);
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
                
                // Фокус на поле ввода
                document.getElementById('game-code-input').focus();
                
                // Таймер
                gameTimer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('time-left').textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        endDecryptionGame(false);
                    }
                }, 1000);
                
                // Обработчики кнопок
                document.getElementById('submit-code').addEventListener('click', function() {
                    const input = document.getElementById('game-code-input').value.toUpperCase();
                    if (input === gameCode) {
                        endDecryptionGame(true);
                    } else {
                        playSound('error');
                        const errorMsg = document.createElement('div');
                        errorMsg.className = 'error-msg';
                        errorMsg.textContent = "Неверный код! Попробуйте еще раз.";
                        terminalOutput.insertBefore(errorMsg, gameContainer.nextSibling);
                        terminalOutput.scrollTop = terminalOutput.scrollHeight;
                    }
                });
                
                document.getElementById('cancel-game').addEventListener('click', function() {
                    endDecryptionGame(false);
                });
            }
            
            // Завершить мини-игру
            function endDecryptionGame(success) {
                clearInterval(gameTimer);
                isDecryptionGameActive = false;
                
                // Удаляем контейнер игры
                const gameContainer = document.querySelector('.decrypt-game');
                if (gameContainer) {
                    gameContainer.remove();
                }
                
                if (success) {
                    accessLevel = 10;
                    checkAchievements();
                    playSound('success');
                    
                    const successMsg = document.createElement('div');
                    successMsg.className = 'system-msg';
                    successMsg.innerHTML = "<span style='color:#0af05f'>Код принят! Расшифровка успешна. Уровень доступа повышен до 10!</span>";
                    
                    const inputLine = document.querySelector('.input-line');
                    terminalOutput.insertBefore(successMsg, inputLine);
                    
                    terminalOutput.scrollTop = terminalOutput.scrollHeight;
                }
            }
            
            // Обработчик ввода команд
            commandInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    playSound('enter');
                    
                    const commandText = commandInput.value.trim();
                    
                    if (commandText) {
                        // Добавляем команду в историю
                        commandHistory.push(commandText);
                        historyIndex = commandHistory.length;
                        
                        // Создаем элемент для отображения команды
                        const commandElement = document.createElement('div');
                        commandElement.className = 'output command-history';
                        commandElement.innerHTML = `<span class="prompt">></span> ${commandText}`;
                        
                        // Вставляем перед полем ввода
                        const inputLine = document.querySelector('.input-line');
                        terminalOutput.insertBefore(commandElement, inputLine);
                        
                        // Обработка команды
                        processCommand(commandText);
                        
                        // Очищаем ввод
                        commandInput.value = '';
                        
                        // Прокрутка вниз
                        terminalOutput.scrollTop = terminalOutput.scrollHeight;
                    }
                } else if (e.key === 'ArrowUp') {
                    // Навигация по истории вверх
                    e.preventDefault();
                    if (commandHistory.length > 0) {
                        if (historyIndex > 0) historyIndex--;
                        commandInput.value = commandHistory[historyIndex] || '';
                    }
                } else if (e.key === 'ArrowDown') {
                    // Навигация по истории вниз
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        commandInput.value = commandHistory[historyIndex] || '';
                    } else {
                        historyIndex = commandHistory.length;
                        commandInput.value = '';
                    }
                } else {
                    playSound('key');
                }
            });
            
            // Функция обработки команды
            function processCommand(cmd) {
                const commandParts = cmd.split(' ');
                const baseCommand = commandParts[0].toLowerCase();
                
                let response = "";
                
                if (commands[baseCommand]) {
                    response = commands[baseCommand].execute();
                } else if (cmd) {
                    response = `<span class="error-msg">Ошибка: команда "${baseCommand}" не найдена. Введите "help" для списка команд.</span>`;
                    playSound('error');
                }
                
                if (response) {
                    const outputElement = document.createElement('div');
                    
                    if (baseCommand === 'lore') {
                        outputElement.className = 'lore-msg';
                        outputElement.innerHTML = `<i class="fas fa-archive"></i> ФРАГМЕНТ АРХИВА #${loreFragmentsFound}:\n${response}`;
                    } else if (baseCommand === 'admin_lore') {
                        outputElement.className = 'admin-msg';
                        outputElement.innerHTML = `<i class="fas fa-lock"></i> АРХИВ ЧЕРНОГО УРОВНЯ:\n${response}`;
                    } else if (response.includes('ОШИБКА')) {
                        outputElement.className = 'error-msg';
                        outputElement.innerHTML = response;
                    } else {
                        outputElement.className = 'output';
                        outputElement.textContent = response;
                    }
                    
                    const inputLine = document.querySelector('.input-line');
                    terminalOutput.insertBefore(outputElement, inputLine);
                }
                
                // Прокрутка вниз
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
            
            // Автофокус на поле ввода
            commandInput.focus();
            
            // Эффект мигающего курсора
            setInterval(() => {
                const prompt = document.querySelector('.prompt');
                prompt.style.opacity = prompt.style.opacity === '0.5' ? '1' : '0.5';
            }, 500);
            
            // Обработка кнопок управления
            document.querySelector('.control-btn.close').addEventListener('click', function() {
                document.body.innerHTML = '<div class="system-msg" style="text-align:center;padding:50px;color:#0af05f">Соединение прервано. Терминал отключен.</div>';
            });
            
            document.querySelector('.control-btn.minimize').addEventListener('click', function() {
                terminalOutput.style.display = terminalOutput.style.display === 'none' ? 'flex' : 'none';
            });
            
            document.querySelector('.control-btn.maximize').addEventListener('click', function() {
                const container = document.querySelector('.terminal-container');
                container.classList.toggle('fullscreen');
                if (container.classList.contains('fullscreen')) {
                    container.style.position = 'fixed';
                    container.style.top = '0';
                    container.style.left = '0';
                    container.style.width = '100%';
                    container.style.height = '100vh';
                    container.style.maxHeight = 'none';
                    container.style.zIndex = '1000';
                } else {
                    container.style.position = '';
                    container.style.top = '';
                    container.style.left = '';
                    container.style.width = '';
                    container.style.height = '';
                    container.style.maxHeight = '70vh';
                    container.style.zIndex = '';
                }
            });
        });
    </script>
</body>
</html>
